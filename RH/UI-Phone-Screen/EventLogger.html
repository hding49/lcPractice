<!-- è€ƒçš„æ˜¯EventLoggerè¿™é“é¢˜. æ€»å…±å››ä¸ªpart, Part 4 ä¹‹å‰åœ¨åœ°é‡Œå¥½åƒæ²¡çœ‹è¿‡
åœ¨codesandboxé‡Œé¢, ç»™ä½ æå‰æä¾›äº†
ä¸€äº› HTMLå’Œcssä¸éœ€è¦åŠ¨, renderä¸€äº›å°æ–¹å— (åªåœ¨part 1æœ‰ç”¨)
ä¸€ä¸ª utils file ä¹Ÿä¸éœ€è¦åŠ¨, é‡Œé¢æä¾›ä¸€ä¸ªå‡çš„async function, ç”¨æ¥æ¨¡æ‹Ÿä¸Šä¼  events
ä¸€ä¸ª EventLogger classçš„åŸºæœ¬é›å½¢, åªæœ‰ä¸€ä¸ª logEvent functionçš„é›å½¢
ä¸€ä¸ª index.js æ–‡ä»¶, ç”¨æ¥è°ƒç”¨ EventLogger class
Part 1
éœ€è¦ç”¨javascriptè‡ªå¸¦çš„DOM querying functionsæ¥æ‰¾åˆ°è¿™äº›æ–¹å—, ç„¶åŽç»™æ¯ä¸ªæ–¹å—åŠ click handler, æ¯æ¬¡ç‚¹å‡»éƒ½logä¸€ä¸ªevent
eventé‡Œéœ€è¦å¸¦ä¸€äº›ä¿¡æ¯, éƒ½æŒºç®€å•çš„ e.g. è¿™ä¸ªæ–¹å—çš„é¢œè‰², çŽ°åœ¨çš„æ—¶é—´ç­‰ç­‰
Part 2

ä»Žpart 2å¼€å§‹å°±ä¸éœ€è¦ç®¡å‰é¢é‚£äº›æ–¹å—äº†, é¢è¯•å®˜ä¼šç»™ä½ pasteè¿›æ¥ä¸€äº›test cases
æ¯ä¸ªeventéƒ½ä¸Šä¼ ä¸€æ¬¡ä¸å¤Ÿefficient, çŽ°åœ¨è¦åŠ ä¸€ä¸ªinterval, intervalé‡Œè¿›æ¥çš„eventséƒ½æ”¾åˆ°ä¸€ä¸ªbatché‡Œæœ€åŽä¸Šä¼ 
Part 3
å¦‚æžœæ¯æ¬¡ä¸Šä¼ eventsçš„requestéƒ½èŠ±æ¯”è¾ƒé•¿çš„æ—¶é—´, å¦‚æžœåœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­æœ‰å…¶ä»–batchçš„eventsè¦ä¸Šä¼ äº†, è¦ç­‰å¾…ç›®å‰æ­£åœ¨ä¸Šä¼ çš„é‚£ä¸ªå®Œæˆ
è¿™é‡Œä»–ä»¬ç»™çš„ä¸Šä¼ è¿™ä¸ªutil funcitonä¼šè¿”å›žä¸€ä¸ªpromise
Part 4
å¦‚æžœä¸€ä¸ªä¸Šä¼ ä¸­çš„requestèŠ±è´¹çš„æ—¶é—´è¶…è¿‡ä¸‰ç§’é’Ÿ, éœ€è¦æŠŠå®ƒç»™abortæŽ‰ (æä¾›çš„helper functionè‡ªå¸¦è¿™ä¸ªfunction)
abortæŽ‰çš„batch, éœ€è¦å’Œä¸‹ä¸€ä¸ªè¦ä¸Šä¼ çš„batchåˆèµ·æ¥, ç„¶åŽå†æ¬¡ä¸Šä¼  -->

<!--
ä½ å°†å®žçŽ°ä¸€ä¸ª EventLogger ç±»å¹¶é€æ­¥å®Œå–„å…¶åŠŸèƒ½ã€‚ç³»ç»Ÿä¼šæå‰æä¾› HTML/CSS å’Œä¸€ä¸ªæ¨¡æ‹Ÿä¸Šä¼  API å·¥å…·ï¼Œæ— éœ€ä¿®æ”¹ã€‚ä½ éœ€è¦ä¸“æ³¨äºŽçº¯ JavaScript å®žçŽ°ã€‚

âœ… æä¾›çš„å†…å®¹
6 ä¸ªå½©è‰²æ–¹å—çš„ HTML é¡µé¢ï¼ˆPart 1 ç”¨ï¼‰

ä¸å¯ä¿®æ”¹çš„ CSS æ–‡ä»¶ï¼ˆè´Ÿè´£æ¸²æŸ“æ ·å¼ï¼‰

ä¸€ä¸ª utils.js æ–‡ä»¶ï¼š

åŒ…å«å¼‚æ­¥çš„ uploadEvents(events) æ–¹æ³•ï¼ˆè¿”å›ž Promiseï¼‰

æ”¯æŒ abort() åŠŸèƒ½ï¼Œç”¨äºŽ Part 4

ä¸€ä¸ª EventLogger ç±»çš„æ¡†æž¶

index.jsï¼šå…¥å£æ–‡ä»¶ï¼Œè°ƒç”¨ EventLogger

ðŸ§© Part 1 - Attach Click Listeners and Log Events
ä½¿ç”¨åŽŸç”Ÿ JSï¼ˆå¦‚ document.querySelectorAll()ï¼‰æ‰¾åˆ°æ‰€æœ‰ .square å…ƒç´ ã€‚

ç»™æ¯ä¸ªæ–¹å—æ·»åŠ  click äº‹ä»¶ç›‘å¬å™¨ã€‚

æ¯æ¬¡ç‚¹å‡»è¦è°ƒç”¨ EventLogger.logEvent(event)ï¼Œè®°å½•ä¸€ä¸ª eventã€‚

æ¯ä¸ª event éœ€è¦åŒ…å«ï¼š

æ–¹å—çš„é¢œè‰²ï¼ˆstyle.backgroundColorï¼‰

å½“å‰æ—¶é—´ï¼ˆnew Date().toISOString()ï¼‰

ä»»æ„ä½ è®¤ä¸ºæœ‰ç”¨çš„å…ƒæ•°æ®

ðŸ§ª Part 2 - Batch Upload by Interval
ä¸å†å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œè€Œæ˜¯å¼€å§‹æµ‹è¯• EventLogger ç±»çš„è¡Œä¸ºã€‚

å®žçŽ°ä¸€ä¸ª batch upload systemï¼š

æ¯ 2 ç§’ä¸Šä¼ ä¸€æ¬¡æ”¶é›†åˆ°çš„ eventsã€‚

åŒä¸€æ—¶é—´æ®µå†…çš„ events åº”è¯¥è¢«æ‰“åŒ…åœ¨åŒä¸€ä¸ª array é‡Œä¸Šä¼ ã€‚

æ³¨æ„ï¼š

è¦ç»´æŠ¤ä¸€ä¸ª queue è®°å½• eventsã€‚

å¯ä»¥ä½¿ç”¨ setInterval å®šæ—¶è§¦å‘ä¸Šä¼ é€»è¾‘ã€‚

ä¸Šä¼ ä½¿ç”¨ uploadEvents(batch)ã€‚

ðŸš¦ Part 3 - Serialize Upload Requests
æ¨¡æ‹Ÿçš„ uploadEvents() æ˜¯å¼‚æ­¥çš„ï¼Œå¯èƒ½è€—æ—¶ã€‚

å¦‚æžœä¸Šä¸€æ¬¡ä¸Šä¼ è¿˜åœ¨è¿›è¡Œä¸­ï¼Œæ–°çš„ä¸€æ‰¹ events éœ€è¦ç­‰å¾…ä¸Šä¼ å®Œæ¯•ã€‚

ä¸å¾—å¹¶å‘ä¸Šä¼ ã€‚ä½ éœ€è¦ queue åŽç»­è¯·æ±‚ã€‚

æŠ€æœ¯æç¤º
ä½ éœ€è¦å®žçŽ°ä¸€ä¸ªæœºåˆ¶ï¼šåªèƒ½ä¸²è¡Œä¸Šä¼ ã€‚

æ¯æ¬¡ä¸Šä¼ å®ŒæˆåŽæ‰è½®åˆ°ä¸‹ä¸€ä¸ª batchã€‚

Promise chainingã€async/await æˆ– upload queue å‡å¯ç”¨ã€‚

ðŸ§¨ Part 4 - Timeout & Retry Failed Batches
å¦‚æžœä¸Šä¼ ä¸€ä¸ª batch è¶…è¿‡ 3 ç§’ï¼Œè®¤ä¸º è¶…æ—¶ã€‚

ä½¿ç”¨æä¾›çš„ abort APIï¼šuploadEvents(events, { signal }) æ”¯æŒ abortã€‚

è¶…æ—¶çš„ batch è¦å’Œä¸‹ä¸€ä¸ª batch åˆå¹¶ä¸Šä¼ ï¼Œå¹¶é‡æ–°ä¸Šä¼ ã€‚

æŠ€æœ¯æç¤º
ä½¿ç”¨ AbortController åˆ›å»º signalã€‚

ä¸Šä¼ ä»»åŠ¡ä¸­è®¾ç½® 3 ç§’è¶…æ—¶ï¼Œè‹¥è¶…æ—¶ï¼š

abortController.abort() è¢«è°ƒç”¨

å½“å‰ batch + ä¸‹ä¸€è½® batch åˆå¹¶åŽå†æ¬¡ä¸Šä¼ 

æ³¨æ„åˆå¹¶åŽä¸Šä¼ ä»éœ€ä¿è¯ä¸²è¡Œæ‰§è¡Œ -->

<!-- å†™ä¸€ä¸ªEventLoggerï¼Œåœ¨ç‚¹å‡»divçš„æ—¶å€™éœ€è¦å‘serverå‘é€ä¿¡æ¯ï¼Œä¼šç»™ä¸€ä¸ªç±»ä¼¼fetchçš„utilã€‚

ç¬¬ä¸€é—®å°±æ˜¯æ‰¾å¥½payloadï¼Œæ”¾è¿›eventé‡Œcallä¸€ä¸‹å°±å¯ä»¥äº†
ç¬¬äºŒé—®æ˜¯å¦‚æžœæœ‰ä¸ªdelivery intervalï¼Œæ€Žä¹ˆåŽ»batch intervalä¹‹é—´çš„call
ç¬¬ä¸‰é—®æ˜¯å¦‚æžœå‰ä¸€ä¸ªrequestè¿˜åœ¨è·‘ï¼Œç¬¬äºŒä¸ªrequestè¿›æ¥éœ€è¦ç­‰å‰ä¸€ä¸ªè·‘å®Œå†è·‘ -->
